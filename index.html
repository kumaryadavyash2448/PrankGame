<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prank Personality & Vibe Test ğŸ”®</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#141e30,#243b55);color:white;}
.container{max-width:600px;margin:auto;padding:20px;}
.hidden{display:none;}
.option{width:90%;padding:18px;margin:12px auto;border-radius:50px;border:none;background:rgba(255,255,255,.2);color:white;font-size:18px;cursor:pointer;transition:0.3s;box-shadow:0 0 5px rgba(0,0,0,.3);}
.option:hover{background:rgba(255,255,255,.35);transform:scale(1.05);}
.btn{padding:15px 30px;border-radius:40px;background:#00c6ff;color:black;font-size:18px;cursor:pointer;margin:10px auto;display:block;}
.loader{width:60px;height:60px;border:7px solid rgba(255,255,255,.3);border-top:7px solid #00c6ff;border-radius:50%;animation:spin 1s linear infinite;margin:30px auto;}
@keyframes spin{100%{transform:rotate(360deg)}}
#cameraSection{position:relative;text-align:center;margin-top:20px;}
#shutter{position:absolute;top:0;left:0;width:100%;height:100%;background:white;opacity:0.8;z-index:100;display:none;}
.progress-bar{width:90%;height:20px;background:rgba(255,255,255,.2);border-radius:10px;margin:20px auto;overflow:hidden;}
.progress-fill{height:100%;width:0%;background:#00c6ff;transition:1s;}
.card{border:1px solid #555;border-radius:15px;padding:10px;margin:10px;background:rgba(0,0,0,.3);}
.status-unused{color:#00ff00;font-weight:bold;}
.status-used{color:#ff4444;font-weight:bold;}
.copyBtn{padding:5px 10px;margin-left:10px;border-radius:15px;background:#fff;color:black;cursor:pointer;}
#confettiCanvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;}
.answers{margin-top:10px;}
</style>
</head>
<body>
<div class="container">

<!-- Landing Page -->
<div id="start">
<h1 style="text-align:center">Personality & Vibe Test ğŸ”®</h1>
<p style="text-align:center">Answer honestlyâ€¦ or try ğŸ˜</p>
<center><button class="btn" onclick="initApp()">Start Test</button></center>
</div>

<!-- Question Section -->
<div id="qBox" class="hidden">
<h2 id="qNo"></h2>
<p id="qText"></p>
<div id="opts"></div>
<div class="progress-bar"><div class="progress-fill" id="qProgress"></div></div>
</div>

<!-- Loading / Analysis -->
<div id="loading" class="hidden">
<div class="loader"></div>
<p id="loadText" style="text-align:center;font-size:18px;"></p>
<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
</div>

<!-- Result Section -->
<div id="result" class="hidden" style="text-align:center;">
<h2>Results</h2>
<p id="lie" style="font-size:20px;"></p>
<p id="msg" style="font-size:18px;"></p>
<p id="per" style="font-size:18px;"></p>
<p id="vibe" style="font-size:18px;"></p>
<button class="btn" onclick="startCameraPrank()">Watch Your Expressions ğŸ˜</button>
</div>

<!-- Camera Prank -->
<div id="cameraSection" class="hidden">
<video id="cam" autoplay playsinline style="width:90%;border-radius:15px;"></video>
<div id="shutter"></div>
<div id="emojiOverlay" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;"></div>
<p id="prankMsg" style="margin-top:10px;font-size:18px;"></p>
<button id="shareBtn" class="btn hidden" onclick="shareToAdmin()">Share with Admin âœ…</button>
<button id="closeBtn" class="btn hidden" onclick="closeCameraPrank()">Close âœ–ï¸</button>
</div>

<!-- Admin Portal -->
<div id="adminPortal" class="hidden">
<h1>Creator Portal ğŸ”</h1>
<input id="nick" placeholder="Link nickname">
<button class="btn" onclick="createLink()">Create Link</button>
<input id="searchNick" placeholder="Search nickname" oninput="filterCards()">
<div id="linksContainer"></div>
</div>

<canvas id="confettiCanvas"></canvas>
</div>

<script>
// ==== Firebase Init ====
firebase.initializeApp({
 apiKey:"AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
 authDomain:"prankgame-6ad46.firebaseapp.com",
 projectId:"prankgame-6ad46"
});
const db=firebase.firestore();
const params=new URLSearchParams(location.search);
const playId=params.get("play");
const adminKey=params.get("admin");

// ==== Questions & Data ====
const Q=[
{q:"ğŸ˜¶â€ğŸŒ«ï¸ Have you ever smiled at your phone and quickly locked it?",o:["ğŸ˜‚ YES","ğŸ˜¬ NO","ğŸ¤” MAYBE"]},
{q:"ğŸ§  Do you overthink conversations that already ended?",o:["ğŸ˜ YES","ğŸ™„ NO","ğŸ˜ MAYBE"]},
{q:"ğŸ˜Œ Have you said â€œIâ€™m fineâ€ when you werenâ€™t?",o:["ğŸ˜… YES","ğŸ˜¶ NO","ğŸ¤·â€â™‚ï¸ MAYBE"]},
{q:"ğŸ‘€ Ever stalked someone accidentally liking old post?",o:["ğŸ˜ YES","ğŸ™ˆ NO","ğŸ˜ MAYBE"]},
{q:"ğŸŒ™ Does your brain become creative at 2 AM?",o:["ğŸŒŸ YES","ğŸ˜´ NO","ğŸ¤” MAYBE"]},
{q:"ğŸ˜³ Have you hidden feelings when someone asked directly?",o:["ğŸ˜¬ YES","ğŸ˜¶ NO","ğŸ¤” MAYBE"]},
{q:"ğŸ˜µâ€ğŸ’« Have you felt insecure around a friend?",o:["ğŸ˜… YES","ğŸ™„ NO","ğŸ¤” MAYBE"]},
{q:"ğŸŒ€ Have you replayed conversations in your head?",o:["ğŸ˜ YES","ğŸ™„ NO","ğŸ¤·â€â™‚ï¸ MAYBE"]},
{q:"ğŸ¤¯ Do you overthink at night?",o:["ğŸ˜µ YES","ğŸ˜¶ NO","ğŸ˜ MAYBE"]},
{q:"ğŸ˜… Have you found a better person than admin?",o:["No ğŸ˜µâ€ğŸ’«","Yash ğŸ˜"]}
];

const personalities=["Silent Overthinker ğŸ§ ","Chill but Observant ğŸ˜","Drama Friendly ğŸ­","Secret Keeper ğŸ¤","Curious Explorer ğŸ”"];
const vibes=["Calm but unpredictable","Friendly with hidden depth","Low drama, high awareness","Energetic and spontaneous","Quiet but sharp"];
const funLines=["You answered confidentlyâ€¦ maybe too confidently ğŸ˜","Your honesty fluctuated during the test","Sometimes honesty is complicated ğŸ˜‰","You know the truth, but chose convenience"];
let i=0,ans=[];

// ==== Init App based on URL ====
function initApp(){
 if(adminKey){
   showAdmin();
 } else if(playId){
   startTest();
 } else {
   alert("Invalid or expired link");
 }
}

// ==== Test Flow ====
async function startTest(){
 const doc=await db.collection("links").doc(playId).get();
 if(!doc.exists||doc.data().status==="used"){alert("Link already used");return;}
 document.getElementById("start").classList.add("hidden");
 showQ();
}

function showQ(){
 if(i>=Q.length){submit();return;}
 document.getElementById("qBox").classList.remove("hidden");
 document.getElementById("qNo").innerText="Question "+(i+1)+" / "+Q.length;
 document.getElementById("qText").innerText=Q[i].q;
 const o=document.getElementById("opts");o.innerHTML="";
 Q[i].o.forEach(v=>{
  const b=document.createElement("button");
  b.className="option";b.innerText=v;
  b.onclick=()=>{ans.push({q:Q[i].q,a:v});i++;showQ();updateProgress();}
  o.appendChild(b);
 });
 updateProgress();
}
function updateProgress(){document.getElementById("qProgress").style.width=(i/Q.length*100)+"%";}

function submit(){
 document.getElementById("qBox").classList.add("hidden");
 document.getElementById("loading").classList.remove("hidden");
const steps=["ğŸ” Analyzing honestyâ€¦","ğŸ§  Scanning personalityâ€¦","ğŸ­ Checking vibesâ€¦","ğŸ“Š Finalizing reportâ€¦"];
let s=0;
const loadText=document.getElementById("loadText");
const fill=document.getElementById("progressFill");
const interval=setInterval(()=>{
  if(s>=steps.length){clearInterval(interval);showResults();return;}
  loadText.innerText=steps[s];
  fill.style.width=((s+1)/steps.length*100)+"%";
  s++;
},1200);

const lie=Math.floor(Math.random()*20)+76;
setTimeout(()=>{
 db.collection("links").doc(playId).update({
  status:"used",
  answers:ans,
  lie,
  personality:personalities[Math.floor(Math.random()*personalities.length)],
  vibe:vibes[Math.floor(Math.random()*vibes.length)],
  done:Date.now()
 });
},5000);
}

function showResults(){
 document.getElementById("loading").classList.add("hidden");
 document.getElementById("result").classList.remove("hidden");
const liePercent=Math.floor(Math.random()*20)+76;
document.getElementById("lie").innerText="Lie Probability: "+liePercent+"%";
document.getElementById("msg").innerText=funLines[Math.floor(Math.random()*funLines.length)];
document.getElementById("per").innerText="Personality: "+personalities[Math.floor(Math.random()*personalities.length)];
document.getElementById("vibe").innerText="Vibe: "+vibes[Math.floor(Math.random()*vibes.length)];
startConfetti();
}

// ==== Camera Prank ====
function startCameraPrank(){
 document.getElementById("result").classList.add("hidden");
 document.getElementById("cameraSection").classList.remove("hidden");
 const video=document.getElementById("cam");
 navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:false})
 .then(stream=>{video.srcObject=stream;
 blinkAndShutter(0);})
 .catch(()=>{alert("Camera permission denied ğŸ˜…");});
}
function blinkAndShutter(count){
 const shutter=document.getElementById("shutter");
 const emojiOverlay=document.getElementById("emojiOverlay");
 if(count>=3){
   document.getElementById("shareBtn").classList.remove("hidden");
   document.getElementById("closeBtn").classList.remove("hidden");
   document.getElementById("prankMsg").innerText="ğŸ˜Œ Relaxâ€¦ no photo was taken. Just a prank ğŸ˜‚";
   return;
 }
 shutter.style.display="block";
 playShutterSound();
 showRandomEmoji();
setTimeout(()=>{shutter.style.display="none";emojiOverlay.innerHTML="";},400);
setTimeout(()=>{blinkAndShutter(count+1);},800);
}
function playShutterSound(){const audio=new Audio("https://www.soundjay.com/camera/camera-shutter-click-03.mp3");audio.play();}
function showRandomEmoji(){
 const overlay=document.getElementById("emojiOverlay");
 const emojis=["ğŸ˜‚","ğŸ˜","ğŸ˜±","ğŸ¤ª","ğŸ¤¯"];
 for(let i=0;i<10;i++){
   const span=document.createElement("span");
   span.innerText=emojis[Math.floor(Math.random()*emojis.length)];
   span.style.position="absolute";
   span.style.top=Math.random()*80+"%";
   span.style.left=Math.random()*80+"%";
   span.style.fontSize=(Math.random()*30+20)+"px";
   overlay.appendChild(span);
 }
}
function shareToAdmin(){alert("âœ… Shared with Admin (just a prank!)");closeCameraPrank();}
function closeCameraPrank(){document.getElementById("cameraSection").classList.add("hidden");document.getElementById("result").classList.remove("hidden");}

// ==== Admin Portal ====
function showAdmin(){
 document.getElementById("start").classList.add("hidden");
 document.getElementById("adminPortal").classList.remove("hidden");
 const BASE=location.origin+location.pathname;
 db.collection("links").orderBy("done","desc").onSnapshot(snapshot=>{
   const container=document.getElementById("linksContainer"); container.innerHTML="";
   snapshot.forEach(doc=>{
     const data=doc.data();
     const card=document.createElement("div");
     card.className="card";
     card.innerHTML=`<b>${data.nickname||"-"}</b> 
      <span class="${data.status==='used'?'status-used':'status-unused'}">[${data.status}]</span>
      <button class="copyBtn" onclick="copyLink('${BASE}?play=${doc.id}')">Copy Link</button>
      <button class="copyBtn" onclick="deleteLink('${doc.id}')">Delete</button>
      <div class="answers hidden"></div>`;
     card.querySelector("b").onclick=()=>{
       const ansDiv=card.querySelector(".answers");
       if(ansDiv.classList.contains("hidden")){
         ansDiv.classList.remove("hidden");
         const a=(data.answers||[]).map(v=>v.q+" â†’ "+v.a).join("<br>");
         ansDiv.innerHTML=`<p><b>Lie %:</b> ${data.lie||'-'}</p>
                           <p><b>Personality:</b> ${data.personality||'-'}</p>
                           <p><b>Vibe:</b> ${data.vibe||'-'}</p>
                           <p><b>Answers:</b><br>${a||'-'}</p>`;
       } else {ansDiv.classList.add("hidden");}
     };
     container.appendChild(card);
   });
 });
}
function createLink(){
 const n=document.getElementById("nick").value.trim();if(!n)return alert("Enter nickname");
 const id="L"+Date.now();
 db.collection("links").doc(id).set({nickname:n,status:"unused",created:Date.now()})
 .then(()=>{navigator.clipboard.writeText(location.origin+location.pathname+"?play="+id);alert("Link copied!");});
}
function copyLink(link){navigator.clipboard.writeText(link);alert("Copied!");}

// ==== Confetti ====
function startConfetti(){
 const canvas=document.getElementById("confettiCanvas");
 const ctx=canvas.getContext("2d");
 canvas.width=window.innerWidth;
 canvas.height=window.innerHeight;
 const confetti=[];
 for(let i=0;i<150;i++){confetti.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*6+4,d:Math.random()*15})}
 function draw(){
   ctx.clearRect(0,0,canvas.width,canvas.height);
   confetti.forEach(c=>{
     ctx.fillStyle="rgba(255,255,255,0.8)";
     ctx.beginPath();ctx.arc(c.x,c.y,c.r,0,2*Math.PI);ctx.fill();
     c.y+=c.d/2;c.x+=Math.sin(c.y/10);if(c.y>canvas.height){c.y=0;c.x=Math.random()*canvas.width;}
   });
   requestAnimationFrame(draw);
 }
 draw();
}
function filterCards(){
 const val=document.getElementById("searchNick").value.toLowerCase();
 document.querySelectorAll("#linksContainer .card").forEach(c=>{
   c.style.display=c.innerText.toLowerCase().includes(val)?"block":"none";
});
}
</script>
</body>
</html>
