<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prank Personality & Vibe Test üîÆ</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#141e30,#243b55);color:white;}
.container{max-width:600px;margin:auto;padding:20px;}
.hidden{display:none;}
.option{width:90%;padding:18px;margin:12px auto;border-radius:50px;border:none;background:rgba(255,255,255,.2);color:white;font-size:18px;cursor:pointer;transition:0.3s;}
.option:hover{background:rgba(255,255,255,.35);transform:scale(1.05);}
.btn{padding:15px 30px;border-radius:40px;background:#00c6ff;color:black;font-size:18px;cursor:pointer;margin:10px auto;display:block;}
.loader{width:60px;height:60px;border:7px solid rgba(255,255,255,.3);border-top:7px solid #00c6ff;border-radius:50%;animation:spin 1s linear infinite;margin:30px auto;}
@keyframes spin{100%{transform:rotate(360deg)}}
#cameraSection{position:relative;text-align:center;margin-top:20px;}
#shutter{position:absolute;top:0;left:0;width:100%;height:100%;background:white;opacity:0.8;z-index:100;}
.progress-bar{width:90%;height:20px;background:rgba(255,255,255,.2);border-radius:10px;margin:20px auto;overflow:hidden;}
.progress-fill{height:100%;width:0%;background:#00c6ff;transition:1s;}
.card{border:1px solid #555;border-radius:15px;padding:10px;margin:10px;}
.status-unused{color:#00ff00;font-weight:bold;}
.status-used{color:#ff4444;font-weight:bold;}
.copyBtn{padding:5px 10px;margin-left:10px;border-radius:15px;background:#fff;color:black;cursor:pointer;}
</style>
</head>
<body>
<div class="container">

<!-- Landing Page -->
<div id="start">
<h1 style="text-align:center">Personality & Vibe Test üîÆ</h1>
<p style="text-align:center">Answer honestly‚Ä¶ or try üòè</p>
<center><button class="btn" onclick="initApp()">Start Test</button></center>
</div>

<!-- Question Section -->
<div id="qBox" class="hidden">
<h2 id="qNo"></h2>
<p id="qText"></p>
<div id="opts"></div>
</div>

<!-- Loading / Analysis -->
<div id="loading" class="hidden">
<div class="loader"></div>
<p id="loadText" style="text-align:center;font-size:18px;"></p>
<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
</div>

<!-- Result Section -->
<div id="result" class="hidden" style="text-align:center;">
<h2>Results</h2>
<p id="lie" style="font-size:20px;"></p>
<p id="msg" style="font-size:18px;"></p>
<p id="per" style="font-size:18px;"></p>
<p id="vibe" style="font-size:18px;"></p>
<button class="btn" onclick="startCameraPrank()">Take a Photo for Admin üòé</button>
</div>

<!-- Camera Prank -->
<div id="cameraSection" class="hidden">
<video id="cam" autoplay playsinline style="width:90%;border-radius:15px;"></video>
<div id="shutter" class="hidden"></div>
<p id="prankMsg" style="margin-top:10px;font-size:18px;"></p>
</div>

<!-- Admin Portal -->
<div id="adminPortal" class="hidden">
<h1>Creator Portal üîê</h1>
<input id="nick" placeholder="Link nickname">
<button class="btn" onclick="createLink()">Create Link</button>
<div id="linksContainer"></div>
</div>

</div>

<script>
// ==== Firebase Init ====
firebase.initializeApp({
 apiKey:"AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
 authDomain:"prankgame-6ad46.firebaseapp.com",
 projectId:"prankgame-6ad46"
});
const db=firebase.firestore();
const params=new URLSearchParams(location.search);
const playId=params.get("play");
const adminKey=params.get("admin");

// ==== Questions & Data ====
const Q=[
{q:"üò∂‚Äçüå´Ô∏è Have you ever smiled at your phone and quickly locked it?",o:["üòÇ YES","üò¨ NO","ü§î MAYBE"]},
{q:"üß† Do you overthink conversations that already ended?",o:["üòè YES","üôÑ NO","üòê MAYBE"]},
{q:"üòå Have you said ‚ÄúI‚Äôm fine‚Äù when you weren‚Äôt?",o:["üòÖ YES","üò∂ NO","ü§∑‚Äç‚ôÇÔ∏è MAYBE"]},
{q:"üëÄ Ever stalked someone accidentally liking old post?",o:["üòé YES","üôà NO","üòê MAYBE"]},
{q:"üåô Does your brain become creative at 2 AM?",o:["üåü YES","üò¥ NO","ü§î MAYBE"]},
{q:"üò≥ Have you hidden feelings when someone asked directly?",o:["üò¨ YES","üò∂ NO","ü§î MAYBE"]},
{q:"üòµ‚Äçüí´ Have you felt insecure around a friend?",o:["üòÖ YES","üôÑ NO","ü§î MAYBE"]},
{q:"üåÄ Have you replayed conversations in your head?",o:["üòè YES","üôÑ NO","ü§∑‚Äç‚ôÇÔ∏è MAYBE"]},
{q:"ü§Ø Do you overthink at night?",o:["üòµ YES","üò∂ NO","üòê MAYBE"]},
{q:"üòÖ Have you found a better person than admin?",o:["No üòµ‚Äçüí´","Yash üòÅ"]}
];

const personalities=["Silent Overthinker üß†","Chill but Observant üòé","Drama Friendly üé≠","Secret Keeper ü§ê","Curious Explorer üîç"];
const vibes=["Calm but unpredictable","Friendly with hidden depth","Low drama, high awareness","Energetic and spontaneous","Quiet but sharp"];
const funLines=["You answered confidently‚Ä¶ maybe too confidently üòè","Your honesty fluctuated during the test","Sometimes honesty is complicated üòâ","You know the truth, but chose convenience"];
let i=0,ans=[];

// ==== Init App based on URL ====
function initApp(){
 if(adminKey){
   showAdmin();
 } else if(playId){
   startTest();
 } else {
   alert("Invalid or expired link");
 }
}

// ==== Test Flow ====
async function startTest(){
 const doc=await db.collection("links").doc(playId).get();
 if(!doc.exists||doc.data().status==="used"){alert("Link already used");return;}
 document.getElementById("start").classList.add("hidden");
 showQ();
}

function showQ(){
 if(i>=Q.length){submit();return;}
 document.getElementById("qBox").classList.remove("hidden");
 document.getElementById("qNo").innerText="Question "+(i+1);
 document.getElementById("qText").innerText=Q[i].q;
 const o=document.getElementById("opts");o.innerHTML="";
 Q[i].o.forEach(v=>{
  const b=document.createElement("button");
  b.className="option";b.innerText=v;
  b.onclick=()=>{ans.push({q:Q[i].q,a:v});i++;showQ();}
  o.appendChild(b);
 });
}

function submit(){
 document.getElementById("qBox").classList.add("hidden");
 document.getElementById("loading").classList.remove("hidden");
const steps=["üîç Analyzing honesty‚Ä¶","üß† Scanning personality‚Ä¶","üé≠ Checking vibes‚Ä¶","üìä Finalizing report‚Ä¶"];
let s=0;
const loadText=document.getElementById("loadText");
const fill=document.getElementById("progressFill");
const interval=setInterval(()=>{
  if(s>=steps.length){clearInterval(interval);showResults();return;}
  loadText.innerText=steps[s];
  fill.style.width=((s+1)/steps.length*100)+"%";
  s++;
},1200);

const lie=Math.floor(Math.random()*20)+76;
setTimeout(()=>{
 db.collection("links").doc(playId).update({
  status:"used",
  answers:ans,
  lie,
  personality:personalities[Math.floor(Math.random()*personalities.length)],
  vibe:vibes[Math.floor(Math.random()*vibes.length)],
  done:Date.now()
 });
},5000);
}

function showResults(){
 document.getElementById("loading").classList.add("hidden");
 document.getElementById("result").classList.remove("hidden");
const liePercent=Math.floor(Math.random()*20)+76;
document.getElementById("lie").innerText="Lie Probability: "+liePercent+"%";
document.getElementById("msg").innerText=funLines[Math.floor(Math.random()*funLines.length)];
document.getElementById("per").innerText="Personality: "+personalities[Math.floor(Math.random()*personalities.length)];
document.getElementById("vibe").innerText="Vibe: "+vibes[Math.floor(Math.random()*vibes.length)];
}

// ==== Camera Prank ====
function startCameraPrank(){
 document.getElementById("cameraSection").classList.remove("hidden");
 navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:false})
 .then(stream=>{document.getElementById("cam").srcObject=stream;
 setTimeout(()=>{playShutterSound();simulateShutter();},2000);})
 .catch(()=>{alert("Camera permission denied üòÖ");});
}
function playShutterSound(){
 const audio=new Audio("https://www.soundjay.com/camera/camera-shutter-click-03.mp3");
 audio.play();
}
function simulateShutter(){
 const flash=document.getElementById("shutter");
 flash.classList.remove("hidden");
 setTimeout(()=>{
 flash.classList.add("hidden");
 document.getElementById("prankMsg").innerText="üòå Relax‚Ä¶ no photo was taken. Just a prank üòÇ";
},500);
}

// ==== Admin Portal ====
function showAdmin(){
 document.getElementById("start").classList.add("hidden");
 document.getElementById("adminPortal").classList.remove("hidden");
 const BASE=location.origin+location.pathname;
 db.collection("links").orderBy("done","desc").onSnapshot(snapshot=>{
   const container=document.getElementById("linksContainer"); container.innerHTML="";
   snapshot.forEach(doc=>{
     const x=doc.data();
     const a=(x.answers||[]).map(v=>v.q+" ‚Üí "+v.a).join("<br>");
     container.innerHTML+=`<div class="card">
     <b>Nickname:</b> ${x.nickname||"-"} <br>
     <b>Status:</b> <span class="${x.status==='used'?'status-used':'status-unused'}">${x.status}</span><br>
     <b>Link:</b> <span>${BASE}?play=${doc.id}</span>
     <button class="copyBtn" onclick="copyLink('${BASE}?play=${doc.id}')">Copy</button><br>
     <b>Lie %:</b> ${x.lie||"-"}<br>
     <b>Personality:</b> ${x.personality||"-"}<br>
     <b>Vibe:</b> ${x.vibe||"-"}<br>
     <b>Answers:</b><br>${a||"-"}
     </div>`;
   });
 });
}

function createLink(){
 const n=nick.value.trim();if(!n)return alert("Enter nickname");
 const id="L"+Date.now();
 db.collection("links").doc(id).set({nickname:n,status:"unused",created:Date.now()})
 .then(()=>{navigator.clipboard.writeText(location.origin+location.pathname+"?play="+id);alert("Link copied!");});
}

function copyLink(link){navigator.clipboard.writeText(link);alert("Copied!");}
</script>
</body>
</html>
