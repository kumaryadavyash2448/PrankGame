<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Truth & Personality Scanner</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#0b0f1a;
  color:#eafcff;
}
.hidden{display:none}
.container{max-width:700px;margin:auto;padding:20px}
.btn{
  padding:14px 28px;
  border:none;
  border-radius:40px;
  background:linear-gradient(135deg,#00f7ff,#ff3cac);
  font-weight:700;
  cursor:pointer;
}
.option{
  width:100%;
  margin:10px 0;
  padding:16px;
  border-radius:40px;
  border:1px solid rgba(0,247,255,.4);
  background:rgba(0,247,255,.12);
  color:white;
  cursor:pointer;
}
.option:hover{background:rgba(255,60,172,.25)}
.progress{height:8px;background:#111;border-radius:10px;overflow:hidden}
.progress div{height:100%;width:0%;background:linear-gradient(90deg,#00f7ff,#ff3cac)}
.card{
  padding:14px;
  border-bottom:1px solid #222;
  cursor:pointer;
}
.card:hover{background:#121a33}
.active{box-shadow:inset 4px 0 #00f7ff}
.danger{
  background:#ff4d4d;
  border:none;
  padding:10px 18px;
  border-radius:30px;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>
<body>

<div class="container">

<!-- START -->
<div id="start">
  <h1>Truth & Personality Scanner ðŸ”®</h1>
  <p>Answer honestly. Or try to.</p>
  <button class="btn" onclick="startGame()">Start</button>
</div>

<!-- QUIZ -->
<div id="quiz" class="hidden">
  <h3 id="qNo"></h3>
  <p id="qText"></p>
  <div id="options"></div>
  <div class="progress"><div id="prog"></div></div>
</div>

<!-- LOADER -->
<div id="loader" class="hidden">
  <h3 id="loadText">Analyzing responsesâ€¦</h3>
</div>

<!-- RESULT -->
<div id="result" class="hidden">
  <h2>Result</h2>
  <p id="lie"></p>
  <p id="personality"></p>
  <p id="vibe"></p>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden" style="display:flex;gap:20px">
  <div style="width:35%" id="left"></div>
  <div style="flex:1">
    <h2>Admin Portal</h2>
    <button class="btn" onclick="createLink()">Create New Link</button>
    <p id="newLink"></p>
    <div id="details">Select a response</div>
  </div>
</div>

</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
  authDomain:"prankgame-6ad46.firebaseapp.com",
  projectId:"prankgame-6ad46"
});
const db=firebase.firestore();

/* MODE */
const ADMIN_KEY="K9xP7Q2LmZ";
const params=new URLSearchParams(location.search);
const play=params.get("play");
const admin=params.get("admin");

/* DATA */
const QUESTIONS=[
"Have you ever smiled at your phone and locked it quickly?",
"Do you overthink conversations at night?",
"Have you said 'I'm fine' when you weren't?",
"Do you replay moments that already passed?",
"Have you hidden feelings when asked directly?",
"Have you felt insecure around a friend?",
"Does your mind wake up at 2AM?",
"Do people really know the real you?",
"Have you pretended not to care?",
"Is admin the best person you know? ðŸ˜…"
];

let index=0;
let answers=[];

/* INIT */
if(admin===ADMIN_KEY){
  showAdmin();
}else if(play){
  start.style.display="block";
}else{
  start.innerHTML="<h2>Invalid or expired link</h2>";
}

/* PLAYER FLOW */
function startGame(){
  start.classList.add("hidden");
  quiz.classList.remove("hidden");
  showQ();
}

function showQ(){
  if(index>=QUESTIONS.length){submit();return;}
  qNo.innerText=`Question ${index+1}/${QUESTIONS.length}`;
  qText.innerText=QUESTIONS[index];
  options.innerHTML="";
  ["YES","NO","MAYBE"].forEach(o=>{
    const b=document.createElement("button");
    b.className="option";
    b.innerText=o;
    b.onclick=()=>{
      answers.push({q:QUESTIONS[index],a:o});
      index++;
      prog.style.width=(index/QUESTIONS.length*100)+"%";
      showQ();
    };
    options.appendChild(b);
  });
}

function submit(){
  quiz.classList.add("hidden");
  loader.classList.remove("hidden");
  const steps=[
    "Analyzing honestyâ€¦",
    "Scanning personalityâ€¦",
    "Detecting liesâ€¦",
    "Finalizing reportâ€¦"
  ];
  let s=0;
  const t=setInterval(()=>{
    loadText.innerText=steps[s++]||"Done";
    if(s>steps.length){
      clearInterval(t);
      finish();
    }
  },1200);
}

function finish(){
  loader.classList.add("hidden");
  result.classList.remove("hidden");
  const lieVal=Math.floor(Math.random()*20)+76;
  lie.innerText=`Lie Probability: ${lieVal}%`;
  personality.innerText="Personality: Overthinking Strategist ðŸ§ ";
  vibe.innerText="Vibe: Calm outside, chaos inside ðŸ˜Œ";

  db.collection("links").doc(play).update({
    status:"used",
    answers,
    lie:lieVal,
    time:Date.now()
  });
}

/* ADMIN */
function showAdmin(){
  start.classList.add("hidden");
  admin.classList.remove("hidden");

  db.collection("links").orderBy("time","desc").onSnapshot(s=>{
    left.innerHTML="";
    s.forEach(d=>{
      const c=document.createElement("div");
      c.className="card";
      c.innerHTML=`<b>${d.id}</b><br><small>${d.data().status}</small>`;
      c.onclick=()=>showDetails(d.id,d.data(),c);
      left.appendChild(c);
    });
  });
}

function createLink(){
  const id="PL_"+Date.now();
  db.collection("links").doc(id).set({
    status:"unused",
    created:Date.now()
  }).then(()=>{
    newLink.innerHTML=`Play link:<br><code>${location.origin+location.pathname}?play=${id}</code>`;
  });
}

function showDetails(id,data,card){
  document.querySelectorAll(".card").forEach(c=>c.classList.remove("active"));
  card.classList.add("active");
  details.innerHTML=`
    <p><b>Lie %:</b> ${data.lie||"-"}</p>
    <p>${(data.answers||[]).map(a=>a.q+" â†’ "+a.a).join("<br>")}</p>
    <button class="danger" onclick="del('${id}')">Delete</button>
  `;
}

function del(id){
  if(confirm("Delete response?")){
    db.collection("links").doc(id).delete();
    details.innerText="Deleted âœ”";
  }
}
</script>
</body>
</html>
