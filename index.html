<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neural Truth Scanner</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#05060a;
  color:#e8faff;
}
.hidden{display:none}
:root{
  --neon:#00f7ff;
  --pink:#ff3cac;
}
.btn{
  padding:15px 30px;
  border:none;
  border-radius:40px;
  background:linear-gradient(135deg,var(--neon),var(--pink));
  font-weight:700;
  cursor:pointer;
}
.glass{
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.15);
  border-radius:20px;
  padding:20px;
  box-shadow:0 0 25px rgba(0,247,255,.2);
}
.option{
  width:100%;
  margin:10px 0;
  padding:16px;
  border-radius:40px;
  background:rgba(0,247,255,.12);
  border:1px solid rgba(0,247,255,.4);
  color:white;
  cursor:pointer;
}
.option:hover{background:rgba(255,60,172,.3)}
.progress{height:8px;background:#111;border-radius:10px;overflow:hidden}
.progress div{height:100%;background:linear-gradient(90deg,var(--neon),var(--pink));width:0%}
.spinner{
  width:70px;height:70px;
  border:6px solid #222;
  border-top:6px solid var(--neon);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:auto;
}
@keyframes spin{100%{transform:rotate(360deg)}}
.flash{
  position:fixed;inset:0;background:white;opacity:.9;display:none;z-index:999;
}
.card{
  padding:14px;
  border-bottom:1px solid #222;
  cursor:pointer;
}
.card:hover{background:#0e1630}
.active{box-shadow:inset 4px 0 var(--neon)}
.danger{
  background:#ff4d4d;
  border:none;
  padding:10px 18px;
  border-radius:30px;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>
<body>

<div id="start" class="glass" style="min-height:100vh;display:flex;align-items:center;justify-content:center;text-align:center">
  <div>
    <h1 style="color:var(--neon)">Neural Truth Scanner üß†</h1>
    <p>AI personality & honesty detection</p>
    <button class="btn" onclick="init()">Start</button>
  </div>
</div>

<div id="quiz" class="hidden glass" style="max-width:700px;margin:auto">
  <h3 id="qNo"></h3>
  <p id="qText"></p>
  <div id="options"></div>
  <div class="progress"><div id="prog"></div></div>
</div>

<div id="loader" class="hidden glass" style="text-align:center">
  <div class="spinner"></div>
  <p id="loadText">Initializing scan‚Ä¶</p>
</div>

<div id="result" class="hidden glass">
  <h2>Scan Complete</h2>
  <p id="lieText"></p>
  <p id="perText"></p>
  <p id="vibeText"></p>
  <button class="btn" onclick="cameraPrank()">Analyze Facial Expressions üòè</button>
</div>

<div id="camera" class="hidden glass">
  <video id="video" autoplay playsinline></video>
  <p id="camMsg"></p>
  <button class="btn hidden" id="closeCam" onclick="closeCamera()">Close</button>
</div>

<div id="admin" class="hidden" style="display:flex;height:100vh">
  <div style="width:35%;border-right:1px solid #222" id="left"></div>
  <div style="flex:1;padding:20px">
    <h2>Creator Portal</h2>
    <button class="btn" onclick="createLink()">Create New Link</button>
    <p id="newLink"></p>
    <div id="details">Select a response</div>
  </div>
</div>

<div class="flash" id="flash"></div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
  authDomain:"prankgame-6ad46.firebaseapp.com",
  projectId:"prankgame-6ad46"
});
const db=firebase.firestore();

const ADMIN_KEY="K9xP7Q2LmZ";
const Q=[
"Have you smiled at your phone and locked it fast?",
"Do you overthink at night?",
"Have you said 'I'm fine' when not?",
"Do you replay conversations?",
"Have you hidden feelings?",
"Do you get insecure around friends?",
"Does your brain wake up at 2AM?",
"Do people know real you?",
"Have you pretended not to care?",
"Is admin better than everyone? üòÖ"
];

let idx=0,answers=[];
const p=new URLSearchParams(location.search);
const play=p.get("play");
const admin=p.get("admin");

function init(){
  if(admin===ADMIN_KEY){showAdmin();return;}
  if(!play){alert("Invalid link");return;}
  start.classList.add("hidden");
  quiz.classList.remove("hidden");
  showQ();
}

function showQ(){
  if(idx>=Q.length){submit();return;}
  qNo.innerText=`Question ${idx+1}/${Q.length}`;
  qText.innerText=Q[idx];
  options.innerHTML="";
  ["YES","NO","MAYBE"].forEach(o=>{
    let b=document.createElement("button");
    b.className="option";
    b.innerText=o;
    b.onclick=()=>{
      answers.push({q:Q[idx],a:o});
      idx++;
      prog.style.width=(idx/Q.length*100)+"%";
      showQ();
    };
    options.appendChild(b);
  });
}

function submit(){
  quiz.classList.add("hidden");
  loader.classList.remove("hidden");
  const steps=["Analyzing honesty‚Ä¶","Scanning personality‚Ä¶","Detecting lies‚Ä¶","Finalizing‚Ä¶"];
  let s=0;
  const t=setInterval(()=>{
    loadText.innerText=steps[s++]||"Done";
    if(s>steps.length){clearInterval(t);finish();}
  },1200);
}

function finish(){
  loader.classList.add("hidden");
  result.classList.remove("hidden");
  const lie=Math.floor(Math.random()*20)+76;
  lieText.innerText=`Lie Probability: ${lie}%`;
  perText.innerText="Personality: Overthinking Strategist üß†";
  vibeText.innerText="Vibe: Calm outside, chaos inside üòå";

  db.collection("links").doc(play).update({
    status:"used",
    answers,
    lie,
    time:Date.now()
  });
}

function cameraPrank(){
  result.classList.add("hidden");
  camera.classList.remove("hidden");
  navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
  .then(s=>{
    video.srcObject=s;
    shutter(0);
  });
}

function shutter(n){
  if(n>=3){
    camMsg.innerText="Relax üòÇ No photo was taken. Just a prank.";
    closeCam.classList.remove("hidden");
    return;
  }
  flash.style.display="block";
  new Audio("https://www.soundjay.com/camera/camera-shutter-click-03.mp3").play();
  setTimeout(()=>flash.style.display="none",200);
  setTimeout(()=>shutter(n+1),700);
}

function closeCamera(){
  camera.classList.add("hidden");
  result.classList.remove("hidden");
}

function showAdmin(){
  start.classList.add("hidden");
  admin.classList.remove("hidden");
  db.collection("links").orderBy("time","desc").onSnapshot(s=>{
    left.innerHTML="";
    s.forEach(d=>{
      const c=document.createElement("div");
      c.className="card";
      c.innerHTML=`<b>${d.id}</b><br><small>${d.data().status}</small>`;
      c.onclick=()=>showDetails(d.id,d.data(),c);
      left.appendChild(c);
    });
  });
}

function createLink(){
  const id="PL_"+Date.now();
  db.collection("links").doc(id).set({
    status:"unused",
    createdAt:Date.now()
  });
  newLink.innerHTML=`Play Link:<br>
  <code>${location.origin+location.pathname}?play=${id}</code>`;
}

function showDetails(id,data,card){
  document.querySelectorAll(".card").forEach(c=>c.classList.remove("active"));
  card.classList.add("active");
  details.innerHTML=`
    <p><b>Lie %:</b> ${data.lie||"-"}</p>
    <p>${(data.answers||[]).map(a=>a.q+" ‚Üí "+a.a).join("<br>")}</p>
    <button class="danger" onclick="del('${id}')">Delete</button>
  `;
}

function del(id){
  if(confirm("Delete permanently?")){
    db.collection("links").doc(id).delete();
    details.innerText="Deleted ‚úî";
  }
}
</script>
</body>
</html>
