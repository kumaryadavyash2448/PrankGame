<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Personality & Vibe Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#141e30,#243b55);
  color: white;
}

.container {
  max-width: 600px;
  margin: auto;
  padding: 20px;
}

.hidden { display: none; }

h1, h2 { text-align: center; }

button {
  cursor: pointer;
  border: none;
}

.option {
  width: 90%;
  margin: 12px auto;
  padding: 18px;
  border-radius: 50px;
  font-size: 18px;
  background: rgba(255,255,255,0.15);
  color: white;
  border: 2px solid rgba(255,255,255,0.3);
}

.option:hover {
  background: rgba(255,255,255,0.3);
}

.primary-btn {
  padding: 14px 25px;
  font-size: 18px;
  border-radius: 40px;
  background: #00c6ff;
  color: black;
  display: block;
  margin: 20px auto;
}

.loader {
  width: 60px;
  height: 60px;
  border: 7px solid rgba(255,255,255,0.3);
  border-top: 7px solid #00c6ff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 30px auto;
}

@keyframes spin {
  100% { transform: rotate(360deg); }
}

table {
  width: 100%;
  border-collapse: collapse;
}

td, th {
  border: 1px solid rgba(255,255,255,0.3);
  padding: 8px;
  font-size: 12px;
}
</style>
</head>

<body>
<div class="container">

<!-- LANDING -->
<div id="landing">
  <h1>Personality & Vibe Test üîÆ</h1>
  <p style="text-align:center">Answer honestly‚Ä¶ or try üòè</p>
  <button class="primary-btn" onclick="startTest()">Start</button>
</div>

<!-- QUESTIONS -->
<div id="questionBox" class="hidden">
  <h2 id="qNo"></h2>
  <p id="qText" style="text-align:center"></p>
  <div id="options"></div>
</div>

<!-- LOADING -->
<div id="loading" class="hidden">
  <div class="loader"></div>
  <p style="text-align:center">Analyzing truth patterns‚Ä¶</p>
</div>

<!-- RESULT -->
<div id="result" class="hidden">
  <h2>Result</h2>
  <p id="lie"></p>
  <p id="fun"></p>
  <p id="personality"></p>
  <p id="vibe"></p>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">
  <h2>Creator Portal</h2>

  <input id="nick" placeholder="Link nickname" style="width:100%;padding:10px">
  <button class="primary-btn" onclick="createLink()">Create Link</button>

  <table>
    <thead>
      <tr>
        <th>Nickname</th>
        <th>Status</th>
        <th>Link</th>
        <th>Lie%</th>
      </tr>
    </thead>
    <tbody id="adminTable"></tbody>
  </table>
</div>

</div>

<script>
// üîê CHANGE THIS IF YOU WANT
const ADMIN_KEY = "K9xP7Q2LmZ";

// üî• FIREBASE CONFIG (YOURS)
firebase.initializeApp({
  apiKey: "AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
  authDomain: "prankgame-6ad46.firebaseapp.com",
  projectId: "prankgame-6ad46",
  storageBucket: "prankgame-6ad46.appspot.com",
  messagingSenderId: "446143821762",
  appId: "1:446143821762:web:707cde496699594811885b"
});
const db = firebase.firestore();

// QUESTIONS
const questions = [
 {q:"Have you ever dreamed about your future?", o:["YES","NO","MAYBE"]},
 {q:"Was this year actually good for you?", o:["YES","NO","NOT SURE"]},
 {q:"Have you ever been lost in someone's thoughts?", o:["YES","NO","MAYBE"]},
 {q:"Have you avoided someone intentionally?", o:["YES","NO","MAYBE"]},
 {q:"Have you replayed conversations in your head?", o:["YES","NO","MAYBE"]},
 {q:"Have you pretended to know something?", o:["YES","NO","MAYBE"]},
 {q:"Do people know the real you?", o:["YES","NO","NOT REALLY"]},
 {q:"Have you felt insecure around a friend?", o:["YES","NO","MAYBE"]},
 {q:"Have you hidden true feelings when asked?", o:["YES","NO","MAYBE"]},
 {q:"Have you found a better person than admin üòÖ", o:["No üòµ‚Äçüí´","Yash üòÅ"], skip:true}
];

let index = 0;
let answers = [];
const url = new URLSearchParams(window.location.search);
const playId = url.get("play");
const adminKey = url.get("admin");

// ADMIN ACCESS
if (adminKey === ADMIN_KEY) {
  document.getElementById("admin").classList.remove("hidden");
  document.getElementById("landing").classList.add("hidden");
  loadAdmin();
}

// FRIEND ACCESS
async function startTest() {
  if (!playId) {
    alert("Invalid or expired link");
    return;
  }
  const ref = await db.collection("links").doc(playId).get();
  if (!ref.exists || ref.data().status === "used") {
    alert("This link is already used");
    return;
  }
  document.getElementById("landing").classList.add("hidden");
  showQ();
}

function showQ() {
  if (index >= questions.length) return submit();
  document.getElementById("questionBox").classList.remove("hidden");
  document.getElementById("qNo").innerText = `Question ${index+1}`;
  document.getElementById("qText").innerText = questions[index].q;
  const box = document.getElementById("options");
  box.innerHTML = "";
  questions[index].o.forEach(opt=>{
    const b = document.createElement("button");
    b.className = "option";
    b.innerText = opt;
    b.onclick = ()=>{answers.push({q:questions[index].q,a:opt,skip:questions[index].skip});index++;showQ();};
    box.appendChild(b);
  });
}

function submit() {
  document.getElementById("questionBox").classList.add("hidden");
  document.getElementById("loading").classList.remove("hidden");

  setTimeout(async ()=>{
    const lie = Math.floor(Math.random()*20)+76;
    await db.collection("links").doc(playId).update({
      status:"used",
      answers,
      lie
    });

    document.getElementById("loading").classList.add("hidden");
    document.getElementById("result").classList.remove("hidden");
    document.getElementById("lie").innerText = "Lie Probability: "+lie+"%";
    document.getElementById("fun").innerText = "Your honesty fluctuated suspiciously üòè";
    document.getElementById("personality").innerText = "Personality: Silent Thinker üß†";
    document.getElementById("vibe").innerText = "Vibe: Calm but unpredictable";
  },3000);
}

// ADMIN FUNCTIONS
function createLink() {
  const nick = document.getElementById("nick").value.trim();
  if (!nick) return alert("Enter nickname");
  const id = "L"+Date.now();
  db.collection("links").doc(id).set({
    nickname:nick,
    status:"unused",
    created:Date.now()
  }).then(()=>{
    navigator.clipboard.writeText(location.origin+"?play="+id);
    alert("Link copied!");
    loadAdmin();
  });
}

function loadAdmin() {
  db.collection("links").orderBy("created","desc").onSnapshot(snap=>{
    const t = document.getElementById("adminTable");
    t.innerHTML="";
    snap.forEach(d=>{
      const x=d.data();
      t.innerHTML+=`<tr>
        <td>${x.nickname||""}</td>
        <td>${x.status}</td>
        <td>${location.origin}?play=${d.id}</td>
        <td>${x.lie||"-"}</td>
      </tr>`;
    });
  });
}
</script>
</body>
</html>