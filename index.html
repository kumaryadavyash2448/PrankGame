<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Neural Truth Scanner</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: radial-gradient(circle at top, #111, #000);
  color: #fff;
}
.hidden { display:none; }
.container { padding: 20px; max-width: 500px; margin:auto; }
h1,h2 { text-align:center; }
button {
  width:100%;
  padding:15px;
  border:none;
  border-radius:30px;
  background: linear-gradient(135deg,#00f,#0ff);
  color:#000;
  font-size:16px;
  margin-top:12px;
}
.option {
  background:#111;
  border:1px solid #0ff;
  border-radius:25px;
  padding:15px;
  margin:10px 0;
  text-align:center;
}
input {
  width:100%;
  padding:12px;
  border-radius:20px;
  border:none;
  margin-top:10px;
}
.card {
  background:rgba(255,255,255,0.06);
  padding:15px;
  border-radius:20px;
  margin:10px 0;
}
.progress { text-align:center; opacity:.7; }
.loader { text-align:center; font-size:18px; margin-top:40px; }
video { width:100%; border-radius:20px; }
</style>
</head>

<body>
<div class="container">

<!-- ADMIN -->
<div id="admin" class="hidden">
  <h1>Admin Portal</h1>

  <input id="nick" placeholder="Friend nickname"/>
  <button onclick="createLink()">Create Prank Link</button>

  <div id="adminLinks"></div>
  <hr/>
  <h2>Responses</h2>
  <div id="responses"></div>
</div>

<!-- LANDING -->
<div id="landing" class="hidden">
  <h1>Neural Personality Scan</h1>
  <p style="text-align:center;opacity:.8">
    Advanced AI based personality & honesty test
  </p>
  <button onclick="startQuiz()">Start Scan</button>
</div>

<!-- QUIZ -->
<div id="quiz" class="hidden">
  <h2 id="qText"></h2>
  <div id="options"></div>
  <div class="progress" id="progress"></div>
</div>

<!-- ANALYSIS -->
<div id="analysis" class="hidden">
  <div class="loader" id="analysisText"></div>
</div>

<!-- RESULT -->
<div id="result" class="hidden">
  <h2>Scan Complete</h2>
  <div class="card" id="resultText"></div>
  <button onclick="startCamera()">Analyze Face</button>
</div>

<!-- CAMERA -->
<div id="camera" class="hidden">
  <video id="video" autoplay></video>
</div>

<!-- PRANK MSG -->
<div id="prank" class="hidden">
  <h2>ðŸ˜‚ Relax</h2>
  <p>No photo was taken. Just a prank.</p>
</div>

<!-- EXPIRED -->
<div id="expired" class="hidden">
  <h2>Link Expired</h2>
</div>

</div>

<script>
// ðŸ”¥ FIREBASE CONFIG
firebase.initializeApp({
  apiKey: "AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
  authDomain: "prankgame-6ad46.firebaseapp.com",
  projectId: "prankgame-6ad46"
});
const db = firebase.firestore();

// ðŸ” ADMIN KEY
const ADMIN_HASH = "#admin-k9only";

// QUESTIONS
const questions = [
 "Do you lie to avoid drama?",
 "Do you overthink at night?",
 "Can you keep secrets?",
 "Do you stalk people silently?",
 "Are you emotionally dramatic?",
 "Do you pretend to be strong?",
 "Do you judge people fast?",
 "Do you trust easily?",
 "Do you hide your feelings?",
 "Do you enjoy attention?"
];

let qIndex = 0;
let answers = [];
let linkId = location.hash.replace("#","");

// ROUTING
if(location.hash === ADMIN_HASH){
  show("admin");
  loadResponses();
}else if(linkId){
  checkLink();
}else{
  show("expired");
}

function show(id){
  document.querySelectorAll(".container > div")
    .forEach(d=>d.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// ADMIN
async function createLink(){
  const nick = document.getElementById("nick").value;
  if(!nick) return alert("Nickname required");
  const ref = await db.collection("links").add({
    nick, used:false, created:Date.now()
  });
  const url = location.origin + location.pathname + "#" + ref.id;
  document.getElementById("adminLinks").innerHTML =
    `<div class="card">${nick}<br/>
     <input value="${url}" onclick="this.select()"/></div>`;
}

async function loadResponses(){
  const snap = await db.collection("responses").get();
  const box = document.getElementById("responses");
  box.innerHTML="";
  snap.forEach(d=>{
    const r=d.data();
    box.innerHTML+=`
    <div class="card">
      <b>${r.nick}</b><br/>
      Lie %: ${r.lie}<br/>
      ${r.personality}
    </div>`;
  });
}

// PLAYER
async function checkLink(){
  const doc = await db.collection("links").doc(linkId).get();
  if(!doc.exists || doc.data().used){
    show("expired"); return;
  }
  show("landing");
}

function startQuiz(){
  show("quiz");
  renderQ();
}

function renderQ(){
  document.getElementById("qText").innerText = questions[qIndex];
  document.getElementById("progress").innerText =
    `Question ${qIndex+1} / ${questions.length}`;
  const ops = ["Yes","No","Maybe"];
  document.getElementById("options").innerHTML =
    ops.map(o=>`<div class="option" onclick="answer('${o}')">${o}</div>`).join("");
}

function answer(a){
  answers.push(a);
  qIndex++;
  qIndex < questions.length ? renderQ() : analyze();
}

function analyze(){
  show("analysis");
  const steps=[
    "Analyzing honesty...",
    "Scanning personality...",
    "Detecting lies...",
    "Finalizing report..."
  ];
  let i=0;
  const t=setInterval(()=>{
    document.getElementById("analysisText").innerText=steps[i++];
    if(i===steps.length){
      clearInterval(t);
      finish();
    }
  },1200);
}

async function finish(){
  const lie = Math.floor(Math.random()*20)+75;
  const personality = "Emotionally Chaotic Thinker";
  document.getElementById("resultText").innerHTML =
    `Lie Probability: <b>${lie}%</b><br/><br/>
     Personality: ${personality}<br/>
     Vibe: Unpredictable ðŸ”¥`;

  await db.collection("responses").add({
    nick:(await db.collection("links").doc(linkId).get()).data().nick,
    lie, personality, answers
  });
  await db.collection("links").doc(linkId).update({used:true});
  show("result");
}

// CAMERA PRANK
async function startCamera(){
  show("camera");
  const v=document.getElementById("video");
  const s=await navigator.mediaDevices.getUserMedia({video:true});
  v.srcObject=s;
  setTimeout(()=>{
    v.pause(); s.getTracks().forEach(t=>t.stop());
    show("prank");
  },3500);
}
</script>
</body>
</html>
