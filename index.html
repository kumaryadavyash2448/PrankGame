<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neural Truth Scanner</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Arial;
  background:#05060a;
  color:#e8faff;
}
.hidden{display:none}

:root{
  --neon:#00f7ff;
  --pink:#ff3cac;
}

.glass{
  background:rgba(255,255,255,.07);
  backdrop-filter:blur(14px);
  border:1px solid rgba(255,255,255,.15);
  border-radius:22px;
  padding:25px;
  box-shadow:0 0 35px rgba(0,247,255,.18);
}

.btn{
  padding:15px 28px;
  border-radius:40px;
  border:none;
  background:linear-gradient(135deg,var(--neon),var(--pink));
  font-weight:700;
  cursor:pointer;
}
.btn:hover{transform:scale(1.05)}

input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  margin:10px 0;
}

/* START */
#start{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
}

/* QUIZ */
#quiz{max-width:700px;margin:auto;padding:20px}
.option{
  width:100%;
  margin:12px 0;
  padding:18px;
  border-radius:40px;
  background:rgba(0,247,255,.1);
  border:1px solid rgba(0,247,255,.4);
  cursor:pointer;
}
.option:hover{background:rgba(255,60,172,.25)}

.progress{
  height:10px;
  background:#111;
  border-radius:10px;
  overflow:hidden;
}
.progress div{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--neon),var(--pink));
}

/* LOADER */
.spinner{
  width:70px;height:70px;
  border:6px solid #222;
  border-top:6px solid var(--neon);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:30px auto;
}
@keyframes spin{100%{transform:rotate(360deg)}}

/* CAMERA */
#camera video{
  width:100%;
  border-radius:20px;
}
.flash{
  position:fixed;
  inset:0;
  background:white;
  opacity:.9;
  display:none;
  z-index:999;
}

/* ADMIN */
#admin{display:flex;height:100vh}
#left{width:35%;border-right:1px solid #222;overflow:auto;padding:20px}
#right{flex:1;padding:20px}
.card{
  padding:15px;
  border-bottom:1px solid #222;
  cursor:pointer;
}
.card:hover{background:#0e1630}
.card.active{
  background:#0e1630;
  box-shadow:inset 4px 0 var(--neon);
}
.copy{
  background:#222;
  color:white;
  border:none;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
}
.danger{
  background:#ff4d4d;
  border:none;
  padding:12px 20px;
  border-radius:30px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- START -->
<div id="start">
  <div class="glass">
    <h1>Neural Truth Scanner üß†</h1>
    <p>AI-based honesty & personality analysis</p>
    <button class="btn" onclick="startGame()">Start Scan</button>
  </div>
</div>

<!-- QUIZ -->
<div id="quiz" class="hidden glass">
  <h3 id="qNo"></h3>
  <p id="qText"></p>
  <div id="options"></div>
  <div class="progress"><div id="prog"></div></div>
</div>

<!-- LOADER -->
<div id="loader" class="hidden glass">
  <div class="spinner"></div>
  <p id="loadText">Initializing scan‚Ä¶</p>
</div>

<!-- RESULT -->
<div id="result" class="hidden glass">
  <h2>Scan Complete</h2>
  <p id="lie"></p>
  <p id="per"></p>
  <p id="vibe"></p>
  <button class="btn" onclick="cameraPrank()">Analyze Face üòè</button>
</div>

<!-- CAMERA -->
<div id="camera" class="hidden glass">
  <video id="video" autoplay playsinline></video>
  <p id="camMsg"></p>
  <button class="btn hidden" id="closeCam" onclick="endCamera()">Close</button>
</div>
<div class="flash" id="flash"></div>

<!-- ADMIN -->
<div id="admin" class="hidden">
  <div id="left">
    <div class="glass">
      <h3>Create Link</h3>
      <input id="nick" placeholder="Nickname (e.g. Rahul üòé)">
      <button class="btn" onclick="createLink()">Create Link</button>
      <p id="linkOut"></p>
      <button class="copy hidden" id="copyBtn" onclick="copyLink()">Copy Link</button>
    </div>
    <div id="list"></div>
  </div>
  <div id="right">
    <h2>Details</h2>
    <div id="details">Select a response</div>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAuLOmBQ3xKNcYN2rzOo-3gY3-2UqIIyWk",
  authDomain:"prankgame-6ad46.firebaseapp.com",
  projectId:"prankgame-6ad46"
});
const db=firebase.firestore();

const ADMIN_KEY="K9xP7Q2LmZ";
const params=new URLSearchParams(location.search);
const play=params.get("play");
const admin=params.get("admin");

const Q=[
"Have you smiled at your phone secretly?",
"Do you overthink at night?",
"Have you said ‚ÄòI‚Äôm fine‚Äô when you weren‚Äôt?",
"Do you replay old moments?",
"Have you hidden feelings?",
"Ever felt insecure around a friend?",
"Does your brain wake at 2AM?",
"Do people know real you?",
"Have you pretended not to care?",
"Found someone better than admin? üòÖ"
];

let i=0,answers=[];

/* ROUTING */
if(admin===ADMIN_KEY){showAdmin();}
else if(play){startGame();}
else{}

/* GAME */
function startGame(){
  start.classList.add("hidden");
  quiz.classList.remove("hidden");
  showQ();
}

function showQ(){
  if(i>=Q.length){submit();return;}
  qNo.innerText=`Question ${i+1}/${Q.length}`;
  qText.innerText=Q[i];
  options.innerHTML="";
  ["YES","NO","MAYBE"].forEach(o=>{
    const b=document.createElement("button");
    b.className="option";
    b.innerText=o;
    b.onclick=()=>{
      answers.push({q:Q[i],a:o});
      i++;
      prog.style.width=(i/Q.length*100)+"%";
      showQ();
    };
    options.appendChild(b);
  });
}

function submit(){
  quiz.classList.add("hidden");
  loader.classList.remove("hidden");
  const steps=[
    "Analyzing honesty‚Ä¶",
    "Scanning personality‚Ä¶",
    "Detecting lies‚Ä¶",
    "Finalizing report‚Ä¶"
  ];
  let s=0;
  const t=setInterval(()=>{
    loadText.innerText=steps[s++]||"Done";
    if(s>steps.length){clearInterval(t);finish();}
  },1600);
}

function finish(){
  loader.classList.add("hidden");
  result.classList.remove("hidden");
  const lieP=Math.floor(Math.random()*20)+76;
  lie.innerText=`Lie Probability: ${lieP}%`;
  per.innerText="Personality: Silent Overthinker üß†";
  vibe.innerText="Vibe: Calm outside, chaos inside üòå";

  db.collection("links").doc(play).update({
    status:"used",
    answers,
    lie:lieP,
    time:Date.now()
  });
}

/* CAMERA PRANK */
function cameraPrank(){
  result.classList.add("hidden");
  camera.classList.remove("hidden");
  navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
    .then(s=>{
      video.srcObject=s;
      flashLoop(0);
    });
}

function flashLoop(n){
  if(n>=3){
    camMsg.innerText="Relax üòÇ No photo was taken. Just a prank!";
    closeCam.classList.remove("hidden");
    return;
  }
  flash.style.display="block";
  new Audio("https://www.soundjay.com/camera/camera-shutter-click-03.mp3").play();
  setTimeout(()=>flash.style.display="none",200);
  setTimeout(()=>flashLoop(n+1),700);
}

function endCamera(){
  camera.classList.add("hidden");
  result.classList.remove("hidden");
}

/* ADMIN */
function showAdmin(){
  start.classList.add("hidden");
  adminDiv.classList.remove("hidden");

  db.collection("links").orderBy("time","desc").onSnapshot(snap=>{
    list.innerHTML="";
    snap.forEach(doc=>{
      const d=doc.data();
      const c=document.createElement("div");
      c.className="card";
      c.innerText=d.nickname;
      c.onclick=()=>showDetails(doc.id,d,c);
      list.appendChild(c);
    });
  });
}

function createLink(){
  const n=nick.value.trim();
  if(!n){alert("Nickname required");return;}
  const id="L"+Date.now();
  const url=location.origin+location.pathname+"?play="+id;
  db.collection("links").doc(id).set({
    nickname:n,
    status:"active",
    time:Date.now()
  });
  linkOut.innerText=url;
  copyBtn.classList.remove("hidden");
}

function copyLink(){
  navigator.clipboard.writeText(linkOut.innerText);
  alert("Link copied!");
}

function showDetails(id,d,c){
  document.querySelectorAll(".card").forEach(x=>x.classList.remove("active"));
  c.classList.add("active");
  details.innerHTML=`
    <p><b>Lie %:</b> ${d.lie||"-"}</p>
    <p>${(d.answers||[]).map(a=>a.q+" ‚Üí "+a.a).join("<br>")}</p>
    <button class="danger" onclick="db.collection('links').doc('${id}').delete()">Delete</button>
  `;
}
</script>
</body>
</html>
